import { ACCOUNT_ID } from "./consts";
import { deserializeTx } from "./deserialize-tx";
import { makeStellar } from "./ledger-utils";

export async function sign(envelopeRaw: string) {
  const stellar = await makeStellar(ACCOUNT_ID);
  const tx = await deserializeTx(envelopeRaw);

  const signature = await stellar.sign(tx.hash());

  console.log({
    signature: signature.toString("base64"),
    publicKey: await stellar.publicKey(),
  });
}

void sign(
  "0000000200000000cc87252bd834c3bc5c3bd13491994866e7603b3ee32df2e20e8c5842d2e06e4000010a820004e55f000000030000000100000000000000000000000068b6bde10000000000000001000000000000001800000000000000016934c52a85a15a8a2a0e81dbf401f899b87bff54caa64b692c37a7adccdae0810000000c6368616e67655f61646d696e00000001000000120000000000000000d31a5cbf8351c36f1020558bebc79854355565846b5b9bf1793b61a3bf5bcb93000000010000000000000000000000016934c52a85a15a8a2a0e81dbf401f899b87bff54caa64b692c37a7adccdae0810000000c6368616e67655f61646d696e00000001000000120000000000000000d31a5cbf8351c36f1020558bebc79854355565846b5b9bf1793b61a3bf5bcb930000000000000001000000000000000100000007bd394afea1dad8e69b37c45b8808568e9462708ae1fc1a5d089471b052a7379a0000000100000006000000016934c52a85a15a8a2a0e81dbf401f899b87bff54caa64b692c37a7adccdae08100000014000000010021aec900000000000000a80000000000010a1e00000000"
);
